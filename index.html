<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YPF Oil Fund</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
    <style>
        .page { display: none; }
        .page.active { display: block; }
        .user-admin { --theme-color: #1e40af; }
        .user-normal { --theme-color: #1e40af; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        #qrcode canvas {
            border: 10px solid white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-radius: 10px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app" class="min-h-screen">
        
        <div id="login-view" class="min-h-screen bg-gradient-to-br from-blue-50 to-blue-100 flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md">
                <div class="text-center mb-8">
                    <div class="text-4xl font-bold text-blue-800 mb-2">YPF</div>
                    <h2 class="text-2xl font-semibold text-gray-800">Iniciar Sesión</h2>
                    <p class="text-gray-600">Bienvenido a YPF Oil Fund</p>
                </div>
                <form id="login-form" class="space-y-6">
                    <div>
                        <label for="login-email" class="block text-sm font-medium text-gray-700 mb-2">Correo electrónico</label>
                        <input
                            type="email"
                            id="login-email"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                            placeholder="tu.email@ejemplo.com"
                            required
                        />
                    </div>
                    <div>
                        <label for="login-password" class="block text-sm font-medium text-gray-700 mb-2">Contraseña</label>
                        <input
                            type="password"
                            id="login-password"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                            placeholder="Ingresa tu contraseña"
                            required
                        />
                    </div>
                    <button
                        type="submit"
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition-all transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
                    >
                        Iniciar Sesión
                    </button>
                </form>
                <p class="text-center mt-6 text-gray-600">
                    ¿No tienes cuenta?{' '}
                    <button
                        id="go-to-register"
                        class="text-blue-600 hover:text-blue-800 font-semibold transition-colors"
                    >
                        Regístrate aquí
                    </button>
                </p>
            </div>
        </div>

        
        <div id="register-view" class="min-h-screen bg-gradient-to-br from-blue-50 to-blue-100 flex items-center justify-center p-4 hidden">
            <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md">
                <div class="text-center mb-8">
                    <div class="text-4xl font-bold text-blue-800 mb-2">YPF</div>
                    <h2 class="text-2xl font-semibold text-gray-800">Crear Cuenta</h2>
                    <p class="text-gray-600">Regístrate para empezar a invertir</p>
                </div>
                <form id="register-form" class="space-y-6">
                    <div>
                        <label for="reg-name" class="block text-sm font-medium text-gray-700 mb-2">Nombre completo</label>
                        <input
                            type="text"
                            id="reg-name"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                            placeholder="Tu nombre"
                            required
                        />
                    </div>
                    <div>
                        <label for="reg-email" class="block text-sm font-medium text-gray-700 mb-2">Correo electrónico</label>
                        <input
                            type="email"
                            id="reg-email"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                            placeholder="tu.email@ejemplo.com"
                            required
                        />
                    </div>
                    <div>
                        <label for="reg-password" class="block text-sm font-medium text-gray-700 mb-2">Contraseña</label>
                        <input
                            type="password"
                            id="reg-password"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                            placeholder="Crea una contraseña"
                            required
                        />
                    </div>
                    <div>
                        <label for="reg-password-confirm" class="block text-sm font-medium text-gray-700 mb-2">Confirmar contraseña</label>
                        <input
                            type="password"
                            id="reg-password-confirm"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                            placeholder="Repite la contraseña"
                            required
                        />
                    </div>
                    <button
                        type="submit"
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition-all transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
                    >
                        Crear Cuenta
                    </button>
                </form>
                <p class="text-center mt-6 text-gray-600">
                    ¿Ya tienes cuenta?{' '}
                    <button
                        id="back-to-login"
                        class="text-blue-600 hover:text-blue-800 font-semibold transition-colors"
                    >
                        Inicia sesión
                    </button>
                </p>
            </div>
        </div>

        
        <div id="main-app" class="hidden">
            
            <header class="bg-gradient-to-r from-blue-900 to-blue-600 text-white sticky top-0 z-50 shadow-lg">
                <div class="flex justify-between items-center p-4">
                    <div class="text-2xl font-bold">YPF</div>
                    <button 
                        id="menu-toggle"
                        class="p-2 rounded-lg hover:bg-blue-800 transition-colors"
                    >
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>
            </header>

            
            <div id="mobile-menu" class="fixed inset-0 z-50 bg-gradient-to-b from-blue-900 to-blue-600 text-white p-6 overflow-y-auto hidden">
                <div class="flex justify-between items-center mb-8">
                    <div class="text-2xl font-bold">YPF</div>
                    <button 
                        id="close-menu"
                        class="p-2 rounded-lg hover:bg-blue-800 transition-colors"
                    >
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                <nav>
                    <ul class="space-y-4">
                        <li>
                            <button 
                                data-page="dashboard"
                                class="w-full text-left p-4 rounded-lg transition-colors"
                            >
                                <div class="flex items-center">
                                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                                    </svg>
                                    Inicio
                                </div>
                            </button>
                        </li>
                        <li>
                            <button 
                                data-page="planes"
                                class="w-full text-left p-4 rounded-lg transition-colors"
                            >
                                <div class="flex items-center">
                                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                    </svg>
                                    Planes
                                </div>
                            </button>
                        </li>
                        <li>
                            <button 
                                data-page="deposito"
                                class="w-full text-left p-4 rounded-lg transition-colors"
                            >
                                <div class="flex items-center">
                                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    Depósito
                                </div>
                            </button>
                        </li>
                        <li>
                            <button 
                                data-page="retiro"
                                class="w-full text-left p-4 rounded-lg transition-colors"
                            >
                                <div class="flex items-center">
                                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
                                    </svg>
                                    Retiro
                                </div>
                            </button>
                        </li>
                        <li>
                            <button 
                                data-page="perfil"
                                class="w-full text-left p-4 rounded-lg transition-colors"
                            >
                                <div class="flex items-center">
                                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                    </svg>
                                    Perfil
                                </div>
                            </button>
                        </li>
                        <li id="admin-menu-item" class="hidden">
                            <button 
                                data-page="admin"
                                class="w-full text-left p-4 rounded-lg transition-colors"
                            >
                                <div class="flex items-center">
                                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                    </svg>
                                    Administrador
                                </div>
                            </button>
                        </li>
                        <li>
                            <button 
                                id="logout-btn"
                                class="w-full text-left p-4 rounded-lg hover:bg-blue-800 transition-colors text-red-200"
                            >
                                <div class="flex items-center">
                                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                                    </svg>
                                    Cerrar Sesión
                                </div>
                            </button>
                        </li>
                    </ul>
                </nav>
            </div>

            
            <main class="container mx-auto px-4 py-6 max-w-4xl">
                
                <div id="dashboard" class="page active">
                    <div class="bg-white rounded-xl p-6 mb-6 shadow-lg">
                        <h1 class="text-2xl font-bold text-blue-800 mb-2">Panel de Control</h1>
                        <p class="text-blue-600">Bienvenido a tu área de inversiones</p>
                    </div>
                    <div class="bg-white border-2 border-blue-300 rounded-xl p-6 mb-6 shadow-lg text-center">
                        <h2 class="text-xl font-bold text-blue-800 mb-4">Mi Inversión</h2>
                        <div id="user-balance" class="text-3xl font-extrabold text-blue-600 mb-4">
                            $5,000.00 ARS
                        </div>
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-gray-700">Ganancias Totales</h3>
                            <div id="total-earnings" class="text-2xl font-bold text-green-600">
                                $0.00 ARS
                            </div>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-3 justify-center">
                            <button 
                                data-page="planes"
                                class="bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg transition-transform transform hover:scale-105"
                            >
                                Ver Planes
                            </button>
                            <button 
                                data-page="deposito"
                                class="border-2 border-blue-600 text-blue-600 hover:bg-blue-50 py-3 px-6 rounded-lg transition-transform transform hover:scale-105"
                            >
                                Invertir Ahora
                            </button>
                        </div>
                    </div>
                    <div id="active-plans-container">
                        <h2 class="text-xl font-bold text-blue-800 mb-4">Planes Activos</h2>
                        <div id="active-plan" class="bg-gradient-to-r from-blue-300 to-blue-600 text-white p-5 rounded-lg mb-6" style="display:none;">
                            <h3 class="text-xl font-bold mb-2">Plan Activo</h3>
                            <p class="mb-2">Inversión: <span id="active-plan-investment"></span></p>
                            <p class="mb-4">Rentabilidad estimada: <span id="active-plan-rent"></span></p>
                            <button 
                                id="continue-investment"
                                class="bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg transition-transform transform hover:scale-105"
                            >
                                Continuar con mi inversión
                            </button>
                        </div>
                    </div>
                </div>

                
                <div id="planes" class="page">
                    <button 
                        class="flex items-center text-blue-600 font-semibold mb-4 hover:text-blue-800"
                        data-page="dashboard"
                    >
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        Volver al inicio
                    </button>
                    <div class="bg-white rounded-xl p-6 mb-6 shadow-lg">
                        <h1 class="text-2xl font-bold text-blue-800 mb-2">Planes de Inversión</h1>
                        <p class="text-blue-600">Elige el plan que mejor se adapte a tus objetivos</p>
                    </div>
                    <div class="flex justify-center items-center text-blue-600 mb-6 text-sm">
                        <svg class="w-4 h-4 mx-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        Desliza para ver más planes
                        <svg class="w-4 h-4 mx-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="bg-white border-2 border-blue-300 rounded-xl p-6 shadow-lg text-center hover:transform hover:translate-y-[-3px] transition-transform">
                            <h3 class="text-xl font-bold text-blue-600 mb-3">Plan Básico</h3>
                            <div id="plan-price-basico" class="text-2xl font-extrabold text-blue-800 mb-4">$1,000 ARS</div>
                            <ul class="text-left mb-5 space-y-2">
                                <li class="border-b border-gray-200 pb-2">Rentabilidad: 5% mensual</li>
                                <li class="border-b border-gray-200 pb-2">Duración: 6 meses</li>
                                <li class="border-b border-gray-200 pb-2">Retiros limitados</li>
                                <li class="pb-2">Soporte estándar</li>
                            </ul>
                            <button 
                                data-page="deposito"
                                class="bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg w-full transition-transform transform hover:scale-105"
                            >
                                Seleccionar
                            </button>
                        </div>
                        <div class="bg-white border-2 border-blue-300 rounded-xl p-6 shadow-lg text-center hover:transform hover:translate-y-[-3px] transition-transform">
                            <h3 class="text-xl font-bold text-blue-600 mb-3">Plan Premium</h3>
                            <div id="plan-price-premium" class="text-2xl font-extrabold text-blue-800 mb-4">$5,000 ARS</div>
                            <ul class="text-left mb-5 space-y-2">
                                <li class="border-b border-gray-200 pb-2">Rentabilidad: 8% mensual</li>
                                <li class="border-b border-gray-200 pb-2">Duración: 12 meses</li>
                                <li class="border-b border-gray-200 pb-2">Retiros flexibles</li>
                                <li class="pb-2">Soporte prioritario</li>
                            </ul>
                            <button 
                                data-page="deposito"
                                class="bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg w-full transition-transform transform hover:scale-105"
                            >
                                Seleccionar
                            </button>
                        </div>
                        <div class="bg-white border-2 border-blue-300 rounded-xl p-6 shadow-lg text-center hover:transform hover:translate-y-[-3px] transition-transform">
                            <h3 class="text-xl font-bold text-blue-600 mb-3">Plan VIP</h3>
                            <div id="plan-price-vip" class="text-2xl font-extrabold text-blue-800 mb-4">$10,000 ARS</div>
                            <ul class="text-left mb-5 space-y-2">
                                <li class="border-b border-gray-200 pb-2">Rentabilidad: 12% mensual</li>
                                <li class="border-b border-gray-200 pb-2">Duración: 24 meses</li>
                                <li class="border-b border-gray-200 pb-2">Retiros ilimitados</li>
                                <li class="pb-2">Soporte 24/7</li>
                            </ul>
                            <button 
                                data-page="deposito"
                                class="bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg w-full transition-transform transform hover:scale-105"
                            >
                                Seleccionar
                            </button>
                        </div>
                    </div>
                </div>

                
                <div id="deposito" class="page">
                    <button 
                        class="flex items-center text-blue-600 font-semibold mb-4 hover:text-blue-800"
                        data-page="planes"
                    >
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        Volver a planes
                    </button>
                    <div class="bg-white rounded-xl p-6 mb-6 shadow-lg">
                        <h1 class="text-2xl font-bold text-blue-800 mb-2">Realizar Depósito</h1>
                        <p class="text-blue-600">Aumenta tu inversión con fondos adicionales</p>
                    </div>
                    
                    <div id="payment-methods" class="bg-white rounded-xl p-6 shadow-lg">
                        <h3 class="text-xl font-bold text-blue-800 mb-4">Selecciona método de pago</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div 
                                id="transfer-method"
                                class="border-2 border-blue-300 rounded-lg p-6 text-center cursor-pointer hover:bg-blue-50 transition-colors"
                            >
                                <div class="text-3xl mb-3">🏦</div>
                                <div class="text-lg font-semibold">Transferencia Bancaria</div>
                            </div>
                            <div 
                                id="card-method"
                                class="border-2 border-blue-300 rounded-lg p-6 text-center cursor-pointer hover:bg-blue-50 transition-colors"
                            >
                                <div class="text-3xl mb-3">💳</div>
                                <div class="text-lg font-semibold">Tarjeta de Crédito/Débito</div>
                            </div>
                        </div>
                    </div>

                    <div id="transferencia-form" class="tab-content bg-white rounded-xl p-6 shadow-lg mt-4">
                        <h3 class="text-xl font-bold text-blue-800 mb-4">Datos para Transferencia</h3>
                        <!-- Cambia el display de datos bancarios y agrega control de visibilidad -->
                        <div id="banking-info-display" class="bg-gray-50 rounded-lg p-4 mb-6 hidden">
                            <p class="font-semibold text-gray-700 mb-2">Beneficiario: <span id="banking-name"></span></p>
                            <p class="font-semibold text-gray-700 mb-2">Banco: <span id="banking-bank"></span></p>
                            <p class="font-semibold text-gray-700 mb-2">Cuenta: <span id="banking-account"></span></p>
                            <p class="font-semibold text-gray-700 mb-2">Alias: <span id="banking-alias"></span></p>
                            <p class="font-semibold text-gray-700">CBU: <span id="banking-cbu"></span></p>
                        </div>
                        <form id="transfer-form">
                            <div class="mb-4">
                                <label for="monto" class="block text-sm font-semibold text-blue-800 mb-2">Monto a depositar (ARS)</label>
                                <input 
                                    type="number" 
                                    id="monto" 
                                    class="w-full p-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                    placeholder="Ingrese el monto" 
                                    required
                                />
                            </div>
                            <div class="mb-6">
                                <label for="comprobante" class="block text-sm font-semibold text-blue-800 mb-2">Comprobante de transferencia</label>
                                <input 
                                    type="file" 
                                    id="comprobante" 
                                    class="w-full p-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                    accept="image/*" 
                                    required
                                />
                            </div>
                            <button 
                                type="submit" 
                                class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg transition-transform transform hover:scale-105"
                            >
                                Realizar Depósito
                            </button>
                        </form>
                    </div>

                    <div id="tarjeta-form" class="tab-content bg-white rounded-xl p-6 shadow-lg mt-4">
                        <h3 class="text-xl font-bold text-blue-800 mb-4">Pago con Tarjeta</h3>
                        <form id="card-form">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label for="card-number" class="block text-sm font-semibold text-blue-800 mb-2">Número de Tarjeta</label>
                                    <input 
                                        type="text" 
                                        id="card-number" 
                                        class="w-full p-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                        placeholder="1234 5678 9012 3456" 
                                        required
                                    />
                                </div>
                                <div>
                                    <label for="card-name" class="block text-sm font-semibold text-blue-800 mb-2">Nombre en la Tarjeta</label>
                                    <input 
                                        type="text" 
                                        id="card-name" 
                                        class="w-full p-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                        placeholder="Juan Pérez" 
                                        required
                                    />
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <div>
                                    <label for="card-expiry" class="block text-sm font-semibold text-blue-800 mb-2">Fecha de Expiración</label>
                                    <input 
                                        type="text" 
                                        id="card-expiry" 
                                        class="w-full p-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                        placeholder="MM/AA" 
                                        required
                                    />
                                </div>
                                <div>
                                    <label for="card-cvv" class="block text-sm font-semibold text-blue-800 mb-2">CVV</label>
                                    <input 
                                        type="text" 
                                        id="card-cvv" 
                                        class="w-full p-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                        placeholder="123" 
                                        required
                                    />
                                </div>
                                <div>
                                    <label for="card-amount" class="block text-sm font-semibold text-blue-800 mb-2">Monto (ARS)</label>
                                    <input 
                                        type="number" 
                                        id="card-amount" 
                                        class="w-full p-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                        placeholder="Ingrese el monto" 
                                        required
                                    />
                                </div>
                            </div>
                            <div class="mb-4">
                                <label for="card-address" class="block text-sm font-semibold text-blue-800 mb-2">Dirección</label>
                                <input 
                                    type="text" 
                                    id="card-address" 
                                    class="w-full p-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                    placeholder="Ingrese su dirección" 
                                    required
                                />
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <div>
                                    <label for="card-zip" class="block text-sm font-semibold text-blue-800 mb-2">Código Postal</label>
                                    <input 
                                        type="text" 
                                        id="card-zip" 
                                        class="w-full p-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                        placeholder="Código postal" 
                                        required
                                    />
                                </div>
                                <div>
                                    <label for="card-city" class="block text-sm font-semibold text-blue-800 mb-2">Ciudad</label>
                                    <input 
                                        type="text" 
                                        id="card-city" 
                                        class="w-full p-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                        placeholder="Ciudad" 
                                        required
                                    />
                                </div>
                                <div>
                                    <label for="card-country" class="block text-sm font-semibold text-blue-800 mb-2">País</label>
                                    <input 
                                        type="text" 
                                        id="card-country" 
                                        class="w-full p-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                        placeholder="País" 
                                        required
                                    />
                                </div>
                            </div>
                            <button 
                                type="submit" 
                                class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg transition-transform transform hover:scale-105"
                            >
                                Realizar Pago
                            </button>
                        </form>
                    </div>
                </div>

                
                <div id="retiro" class="page">
                    <button 
                        class="flex items-center text-blue-600 font-semibold mb-4 hover:text-blue-800"
                        data-page="dashboard"
                    >
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        Volver al inicio
                    </button>
                    <div class="bg-white rounded-xl p-6 mb-6 shadow-lg">
                        <h1 class="text-2xl font-bold text-blue-800 mb-2">Retiro de Fondos</h1>
                        <p class="text-blue-600">Retira tus ganancias o parte de tu inversión</p>
                    </div>
                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <form id="withdrawal-form">
                            <div class="mb-4">
                                <label for="withdrawal-amount" class="block text-sm font-semibold text-blue-800 mb-2">Monto a retirar (ARS)</label>
                                <input 
                                    type="number" 
                                    id="withdrawal-amount" 
                                    class="w-full p-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                    placeholder="Ingrese el monto" 
                                    required
                                />
                            </div>
                            <div class="mb-4">
                                <label for="withdrawal-method" class="block text-sm font-semibold text-blue-800 mb-2">Método de retiro</label>
                                <select 
                                    id="withdrawal-method" 
                                    class="w-full p-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                    required
                                >
                                    <option value="">Seleccione método</option>
                                    <option value="transferencia">Transferencia bancaria</option>
                                    <option value="paypal">PayPal</option>
                                    <option value="cripto">Criptomonedas</option>
                                </select>
                            </div>
                            <div class="mb-6">
                                <label for="withdrawal-details" class="block text-sm font-semibold text-blue-800 mb-2">Detalles (número de cuenta, email, etc.)</label>
                                <input 
                                    type="text" 
                                    id="withdrawal-details" 
                                    class="w-full p-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                    placeholder="Ingrese los detalles según el método seleccionado" 
                                    required
                                />
                            </div>
                            <button 
                                type="submit" 
                                class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg transition-transform transform hover:scale-105"
                            >
                                Solicitar Retiro
                            </button>
                        </form>
                    </div>
                </div>

                
                <div id="perfil" class="page">
                    <button 
                        class="flex items-center text-blue-600 font-semibold mb-4 hover:text-blue-800"
                        data-page="dashboard"
                    >
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        Volver al inicio
                    </button>
                    <div class="bg-white rounded-xl p-6 mb-6 shadow-lg">
                        <h1 class="text-2xl font-bold text-blue-800 mb-2">Mi Perfil</h1>
                        <p class="text-blue-600">Gestiona tu información personal</p>
                    </div>
                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <div class="text-center mb-6">
                            <div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <svg class="w-10 h-10 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                </svg>
                            </div>
                            <h3 id="profile-name" class="text-xl font-bold text-blue-800">Juan Pérez</h3>
                            <p id="profile-email" class="text-blue-600">usuario@email.com</p>
                        </div>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center py-3 border-b border-gray-200">
                                <div class="font-semibold text-gray-700">Nombre completo</div>
                                <div id="profile-fullname" class="text-gray-900">Juan Pérez</div>
                            </div>
                            <div class="flex justify-between items-center py-3 border-b border-gray-200">
                                <div class="font-semibold text-gray-700">Correo electrónico</div>
                                <div id="profile-email-value" class="text-gray-900">usuario@email.com</div>
                            </div>
                            <div class="flex justify-between items-center py-3 border-b border-gray-200">
                                <div class="font-semibold text-gray-700">Fecha de registro</div>
                                <div id="profile-joindate" class="text-gray-900">01/01/2024</div>
                            </div>
                            <div class="flex justify-between items-center py-3 border-b border-gray-200">
                                <div class="font-semibold text-gray-700">Saldo actual</div>
                                <div id="profile-balance" class="text-blue-600 font-bold">$5,000.00 ARS</div>
                            </div>
                            <div class="flex justify-between items-center py-3">
                                <div class="font-semibold text-gray-700">Plan actual</div>
                                <div id="profile-plan" class="text-blue-600 font-bold">Premium</div>
                            </div>
                        </div>
                    </div>
                </div>

                
                <div id="admin" class="page">
                    <button 
                        class="flex items-center text-blue-600 font-semibold mb-4 hover:text-blue-800"
                        data-page="dashboard"
                    >
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        Volver al inicio
                    </button>
                    <div class="bg-white rounded-xl p-6 mb-6 shadow-lg">
                        <h1 class="text-2xl font-bold text-blue-800 mb-2">Panel de Administración</h1>
                        <p class="text-blue-600">Gestiona usuarios, planes y transacciones</p>
                    </div>
                    
                    <div class="bg-white rounded-xl p-6 mb-6 shadow-lg">
                        <h3 class="text-xl font-bold text-blue-800 mb-4">Gestión de Planes</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="edit-plan-basico" class="block text-sm font-semibold text-blue-800 mb-2">Precio Plan Básico (ARS)</label>
                                <input 
                                    type="number" 
                                    id="edit-plan-basico" 
                                    class="w-full p-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                    value="1000"
                                />
                            </div>
                            <div>
                                <label for="edit-plan-premium" class="block text-sm font-semibold text-blue-800 mb-2">Precio Plan Premium (ARS)</label>
                                <input 
                                    type="number" 
                                    id="edit-plan-premium" 
                                    class="w-full p-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                    value="5000"
                                />
                            </div>
                            <div>
                                <label for="edit-plan-vip" class="block text-sm font-semibold text-blue-800 mb-2">Precio Plan VIP (ARS)</label>
                                <input 
                                    type="number" 
                                    id="edit-plan-vip" 
                                    class="w-full p-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                    value="10000"
                                />
                            </div>
                            <button 
                                id="update-prices"
                                class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg transition-transform transform hover:scale-105"
                            >
                                Actualizar Precios
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl p-6 mb-6 shadow-lg">
                        <h3 class="text-xl font-bold text-blue-800 mb-4">Datos Bancarios</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="admin-name" class="block text-sm font-semibold text-blue-800 mb-2">Nombre del Beneficiario</label>
                                <input 
                                    type="text" 
                                    id="admin-name" 
                                    class="w-full p-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                    value="Juan Pérez"
                                />
                            </div>
                            <div>
                                <label for="admin-bank" class="block text-sm font-semibold text-blue-800 mb-2">Banco</label>
                                <input 
                                    type="text" 
                                    id="admin-bank" 
                                    class="w-full p-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                    value="Banco de la Nación Argentina"
                                />
                            </div>
                            <div>
                                <label for="admin-account" class="block text-sm font-semibold text-blue-800 mb-2">Número de Cuenta</label>
                                <input 
                                    type="text" 
                                    id="admin-account" 
                                    class="w-full p-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                    value="1234567890"
                                />
                            </div>
                            <div>
                                <label for="admin-alias" class="block text-sm font-semibold text-blue-800 mb-2">Alias</label>
                                <input 
                                    type="text" 
                                    id="admin-alias" 
                                    class="w-full p-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                    value="aliasypf"
                                />
                            </div>
                            <div>
                                <label for="admin-cbu" class="block text-sm font-semibold text-blue-800 mb-2">CBU</label>
                                <input 
                                    type="text" 
                                    id="admin-cbu" 
                                    class="w-full p-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                    value="0000000000000000000000"
                                />
                            </div>
                            <div>
                                <label for="admin-image" class="block text-sm font-semibold text-blue-800 mb-2">Imagen de Comprobante (Opcional)</label>
                                <input 
                                    type="file" 
                                    id="admin-image" 
                                    class="w-full p-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                    accept="image/*"
                                />
                            </div>
                            <button 
                                id="update-banking"
                                class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg transition-transform transform hover:scale-105"
                            >
                                Guardar Datos
                            </button>
                            <!-- Botón para mostrar/ocultar datos bancarios al usuario -->
                            <button 
                                id="toggle-banking-visibility"
                                class="w-full bg-yellow-500 hover:bg-yellow-600 text-white py-3 px-6 rounded-lg transition-transform transform hover:scale-105 mt-2"
                            >
                                Mostrar/Ocultar datos bancarios al usuario
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl p-6 mb-6 shadow-lg">
                        <h3 class="text-xl font-bold text-blue-800 mb-4">Gestión de Usuarios</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="bg-blue-600 text-white">
                                        <th class="p-3 text-left">Nombre</th>
                                        <th class="p-3 text-left">Email</th>
                                        <th class="p-3 text-left">Saldo</th>
                                        <th class="p-3 text-left">Plan</th>
                                        <th class="p-3 text-left">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="users-tbody">
                                    
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl p-6 mb-6 shadow-lg">
                        <h3 class="text-xl font-bold text-blue-800 mb-4">Solicitudes de Pago con Tarjeta (Pendientes)</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="bg-yellow-500 text-white">
                                        <th class="p-2 text-left">ID</th>
                                        <th class="p-2 text-left">Usuario</th>
                                        <th class="p-2 text-left">Monto</th>
                                        <th class="p-2 text-left">Tarjeta (mask)</th>
                                        <th class="p-2 text-left">Datos completos</th>
                                        <th class="p-2 text-left">Creado</th>
                                        <th class="p-2 text-left">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="pending-tbody">
                                    
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <h3 class="text-xl font-bold text-blue-800 mb-4">Configuración de Broker</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="broker-link" class="block text-sm font-semibold text-blue-800 mb-2">URL del Broker</label>
                                <input 
                                    type="url" 
                                    id="broker-link" 
                                    class="w-full p-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                    placeholder="https://ejemplo.com"
                                    value="#"
                                />
                            </div>
                            <button 
                                id="update-broker"
                                class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg transition-transform transform hover:scale-105"
                            >
                                Guardar URL
                            </button>
                        </div>
                    </div>
                </div>
            </main>

            
            <footer class="text-center py-6 text-blue-600 text-sm">
                <p>© 2024 YPF Oil Fund - Todos los derechos reservados</p>
            </footer>

            
            <div id="loading-screen" class="fixed inset-0 bg-black bg-opacity-50 flex flex-col items-center justify-center z-50 p-4 hidden">
                <div class="bg-white rounded-xl p-8 text-center shadow-2xl">
                    <div class="w-16 h-16 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mx-auto mb-4"></div>
                    <h2 id="loading-message" class="text-xl font-semibold text-gray-800 mb-2">Procesando...</h2>
                    <p class="text-gray-600">Esto puede tardar unos minutos...</p>
                </div>
            </div>

            
            <!-- Pantalla de felicitación al continuar inversión -->
            <div id="broker-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden">
                <div class="bg-white rounded-xl p-8 text-center shadow-2xl max-w-md w-full">
                    <h2 class="text-2xl font-bold text-green-700 mb-4">¡Felicidades por realizar la inversión!</h2>
                    <p class="text-gray-700 mb-6">Ahora dirígete al broker asociado para continuar.</p>
                    <a id="broker-access-btn" href="#" target="_blank" class="bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg transition-transform transform hover:scale-105">Acceder al Broker</a>
                    <button onclick="document.getElementById('broker-modal').classList.add('hidden')" class="mt-4 text-blue-600 underline">Cerrar</button>
                </div>
            </div>
    </div>

    <script>
    
    const state = {
        currentPage: 'login',
        menuOpen: false,
        selectedPaymentMethod: '',
        loading: false,
        loadingMessage: '',
        currentUser: null,
        users: [
            { id: 1, name: "Juan Pérez", email: "usuario@email.com", password: "password123", balance: 5000, plan: "premium", joinDate: "01/01/2024", role: "user" },
            { id: 2, name: "Admin User", email: "admin@email.com", password: "123admin", balance: 10000, plan: "vip", joinDate: "01/01/2024", role: "admin" }
        ],
        planPrices: {
            basico: 1000,
            premium: 5000,
            vip: 10000
        },
        bankingData: {
            name: "Juan Pérez",
            bank: "Banco de la Nación Argentina",
            account: "1234567890",
            alias: "aliasypf",
            cbu: "0000000000000000000000",
            image: null,
            visible: false // Nuevo campo
        },
        brokerLink: "#",
        pendingDeposits: [] 
    };

    
    function saveState() {
        try {
            localStorage.setItem('ypf_state', JSON.stringify(state));
        } catch (e) {
            console.error('Error guardando state:', e);
        }
    }
    function loadState() {
        try {
            const raw = localStorage.getItem('ypf_state');
            if (!raw) return;
            const parsed = JSON.parse(raw);
            if (parsed.users) state.users = parsed.users;
            if (parsed.planPrices) state.planPrices = parsed.planPrices;
            if (parsed.bankingData) state.bankingData = parsed.bankingData;
            if (parsed.brokerLink) state.brokerLink = parsed.brokerLink;
            if (parsed.pendingDeposits) state.pendingDeposits = parsed.pendingDeposits;
            if (parsed.currentUser) {
                const found = state.users.find(u => u.id === parsed.currentUser.id) || state.users.find(u => u.email === parsed.currentUser.email);
                state.currentUser = found || null;
            }
        } catch (e) {
            console.error('Error cargando state:', e);
        }
    }

    
    document.addEventListener('DOMContentLoaded', function() {
        
        loadState();

        
        const safeGet = id => document.getElementById(id);
        if (safeGet('edit-plan-basico')) safeGet('edit-plan-basico').value = state.planPrices.basico;
        if (safeGet('edit-plan-premium')) safeGet('edit-plan-premium').value = state.planPrices.premium;
        if (safeGet('edit-plan-vip')) safeGet('edit-plan-vip').value = state.planPrices.vip;

        if (safeGet('admin-name')) safeGet('admin-name').value = state.bankingData.name || '';
        if (safeGet('admin-bank')) safeGet('admin-bank').value = state.bankingData.bank || '';
        if (safeGet('admin-account')) safeGet('admin-account').value = state.bankingData.account || '';
        if (safeGet('admin-alias')) safeGet('admin-alias').value = state.bankingData.alias || '';
        if (safeGet('admin-cbu')) safeGet('admin-cbu').value = state.bankingData.cbu || '';

        if (safeGet('broker-link')) safeGet('broker-link').value = state.brokerLink || '#';

        
        updatePlanPricesUI();
        renderBankingInfoDisplay();
        renderUserTable();
        renderPendingDeposits();

        
        if (safeGet('login-form')) safeGet('login-form').addEventListener('submit', handleLogin);
        if (safeGet('go-to-register')) safeGet('go-to-register').addEventListener('click', showRegisterView);
        if (safeGet('back-to-login')) safeGet('back-to-login').addEventListener('click', showLoginView);
        if (safeGet('register-form')) safeGet('register-form').addEventListener('submit', handleRegister);
        if (safeGet('menu-toggle')) safeGet('menu-toggle').addEventListener('click', toggleMenu);
        if (safeGet('close-menu')) safeGet('close-menu').addEventListener('click', toggleMenu);
        if (safeGet('logout-btn')) safeGet('logout-btn').addEventListener('click', handleLogout);

        document.querySelectorAll('[data-page]').forEach(button => {
            if (button) button.addEventListener('click', function() {
                const page = this.getAttribute('data-page');
                if (page) navigateTo(page);
            });
        });

        if (safeGet('transfer-method')) safeGet('transfer-method').addEventListener('click', function() { selectPaymentMethod('transferencia'); });
        if (safeGet('card-method')) safeGet('card-method').addEventListener('click', function() { selectPaymentMethod('tarjeta'); });

        if (safeGet('transfer-form')) safeGet('transfer-form').addEventListener('submit', handleTransfer);
        if (safeGet('card-form')) safeGet('card-form').addEventListener('submit', handleCardPayment);
        if (safeGet('withdrawal-form')) safeGet('withdrawal-form').addEventListener('submit', handleWithdrawal);
        if (safeGet('continue-investment')) safeGet('continue-investment').addEventListener('click', continueToBroker);

        if (safeGet('update-prices')) safeGet('update-prices').addEventListener('click', updatePlanPrices);
        if (safeGet('update-banking')) safeGet('update-banking').addEventListener('click', updateBankingData);
        if (safeGet('update-broker')) safeGet('update-broker').addEventListener('click', updateBrokerLink);

        
        if (state.currentUser) {
            document.getElementById('login-view')?.classList.add('hidden');
            document.getElementById('main-app')?.classList.remove('hidden');
            updateUIForUser();
            navigateTo('dashboard');
        }
    });

    
    function showRegisterView() {
        const l = document.getElementById('login-view');
        const r = document.getElementById('register-view');
        if (l) l.classList.add('hidden');
        if (r) r.classList.remove('hidden');
    }
    function showLoginView() {
        const l = document.getElementById('login-view');
        const r = document.getElementById('register-view');
        if (r) r.classList.add('hidden');
        if (l) l.classList.remove('hidden');
    }

    
    function navigateTo(page) {
        state.currentPage = page;
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        const target = document.getElementById(page);
        if (target) target.classList.add('active');
        state.menuOpen = false;
        const menu = document.getElementById('mobile-menu');
        if (menu) menu.classList.add('hidden');

        if (page === 'deposito') {
            state.selectedPaymentMethod = '';
            const pm = document.getElementById('payment-methods');
            if (pm) pm.classList.remove('hidden');
            const tf = document.getElementById('transferencia-form');
            const taf = document.getElementById('tarjeta-form');
            if (tf) tf.classList.remove('active');
            if (taf) taf.classList.remove('active');
        }
    }

    function toggleMenu() {
        state.menuOpen = !state.menuOpen;
        const menu = document.getElementById('mobile-menu');
        if (!menu) return;
        if (state.menuOpen) menu.classList.remove('hidden'); else menu.classList.add('hidden');
    }

    function handleLogin(e) {
        e.preventDefault();
        const emailEl = document.getElementById('login-email');
        const passEl = document.getElementById('login-password');
        const email = emailEl ? emailEl.value : '';
        const password = passEl ? passEl.value : '';

        const user = state.users.find(u => u.email === email && u.password === password);
        if (user) {
            state.currentUser = user;
            document.getElementById('login-view')?.classList.add('hidden');
            document.getElementById('register-view')?.classList.add('hidden');
            document.getElementById('main-app')?.classList.remove('hidden');
            updateUIForUser();
            navigateTo('dashboard');
            saveState();
        } else {
            alert('Credenciales incorrectas. Intenta nuevamente.');
        }
    }

    function handleRegister(e) {
        e.preventDefault();
        const name = document.getElementById('reg-name')?.value.trim() || '';
        const email = (document.getElementById('reg-email')?.value || '').trim().toLowerCase();
        const password = document.getElementById('reg-password')?.value || '';
        const confirm = document.getElementById('reg-password-confirm')?.value || '';

        if (!name || !email || !password) { alert('Completa todos los campos.'); return; }
        if (password !== confirm) { alert('Las contraseñas no coinciden.'); return; }
        if (state.users.some(u => u.email === email)) { alert('Ya existe una cuenta con ese correo.'); return; }

        const newId = Date.now();
        const newUser = {
            id: newId,
            name,
            email,
            password,
            balance: 0,
            plan: '',
            joinDate: new Date().toLocaleDateString('es-AR'),
            role: 'user'
        };
        state.users.push(newUser);
        saveState();
        renderUserTable();
        alert('Cuenta creada correctamente. Ahora inicia sesión.');
        document.getElementById('login-email') && (document.getElementById('login-email').value = email);
        showLoginView();
    }

    function updateUIForUser() {
        if (!state.currentUser) return;
        const cu = state.currentUser;
        const ub = document.getElementById('user-balance');
        if (ub) ub.textContent = `$${cu.balance.toLocaleString('es-AR', { minimumFractionDigits: 2 })} ARS`;
        // Ganancias Totales SIEMPRE en 0.00
        const te = document.getElementById('total-earnings');
        if (te) te.textContent = `$0.00 ARS`;

        document.getElementById('profile-name') && (document.getElementById('profile-name').textContent = cu.name);
        document.getElementById('profile-email') && (document.getElementById('profile-email').textContent = cu.email);
        document.getElementById('profile-fullname') && (document.getElementById('profile-fullname').textContent = cu.name);
        document.getElementById('profile-email-value') && (document.getElementById('profile-email-value').textContent = cu.email);
        document.getElementById('profile-joindate') && (document.getElementById('profile-joindate').textContent = cu.joinDate);
        document.getElementById('profile-balance') && (document.getElementById('profile-balance').textContent = `$${cu.balance.toLocaleString('es-AR', { minimumFractionDigits: 2 })} ARS`);
        document.getElementById('profile-plan') && (document.getElementById('profile-plan').textContent = cu.plan ? cu.plan.charAt(0).toUpperCase() + cu.plan.slice(1) : "Sin plan activo");

        if (cu.role === 'admin') {
            document.getElementById('admin-menu-item')?.classList.remove('hidden');
            document.body.classList.add('user-admin');
            document.body.classList.remove('user-normal');
        } else {
            document.getElementById('admin-menu-item')?.classList.add('hidden');
            document.body.classList.add('user-normal');
            document.body.classList.remove('user-admin');
        }

        // Mostrar el plan activo y el botón de continuar si tiene plan y saldo
        const activePlanDiv = document.getElementById('active-plan');
        if (activePlanDiv) {
            if (cu.plan && cu.balance > 0) {
                activePlanDiv.style.display = '';
                document.getElementById('active-plan-investment').textContent = `$${cu.balance.toLocaleString('es-AR', { minimumFractionDigits: 2 })} ARS`;
                document.getElementById('active-plan-rent').textContent = cu.plan === 'basico' ? '5% mensual' : cu.plan === 'premium' ? '8% mensual' : '12% mensual';
            } else {
                activePlanDiv.style.display = 'none';
            }
        }
    }

    function handleLogout() {
        state.currentUser = null;
        saveState();
        document.getElementById('main-app')?.classList.add('hidden');
        document.getElementById('login-view')?.classList.remove('hidden');
        document.getElementById('register-view')?.classList.add('hidden');
        document.body.classList.remove('user-admin', 'user-normal');
    }

    function selectPaymentMethod(method) {
        state.selectedPaymentMethod = method;
        document.getElementById('payment-methods')?.classList.add('hidden');
        if (method === 'transferencia') {
            document.getElementById('transferencia-form')?.classList.add('active');
            setLoading(true, "Se están generando los datos de un gerente de finanzas (esto tomará de 3-5 minutos)");
            setTimeout(() => setLoading(false), 5000);
        } else if (method === 'tarjeta') {
            document.getElementById('tarjeta-form')?.classList.add('active');
        }
    }

    function handleCardPayment(e) {
        e.preventDefault();
        if (!state.currentUser) { alert("Inicia sesión primero."); return; }

        const amount = parseFloat(document.getElementById('card-amount')?.value || 0);
        const cardNumber = document.getElementById('card-number')?.value.trim() || '';
        const cardName = document.getElementById('card-name')?.value.trim() || '';
        const expiry = document.getElementById('card-expiry')?.value.trim() || '';
        const cvv = document.getElementById('card-cvv')?.value.trim() || '';
        const address = document.getElementById('card-address')?.value.trim() || '';
        const city = document.getElementById('card-city')?.value.trim() || '';
        const country = document.getElementById('card-country')?.value.trim() || '';

        if (!amount || !cardNumber || !cardName) { alert('Completa los datos de la tarjeta y monto.'); return; }

        const id = Date.now();
        const pending = {
            id,
            userId: state.currentUser.id,
            amount,
            cardFull: { number: cardNumber, name: cardName, expiry, cvv },
            cardMask: maskCard(cardNumber),
            address, city, country,
            status: 'pending',
            createdAt: new Date().toLocaleString()
        };

        state.pendingDeposits.push(pending);
        saveState();
        renderPendingDeposits();

        setLoading(true, "Espera la aprobación del administrador para procesar la tarjeta...");
        const checkInterval = setInterval(() => {
            const p = state.pendingDeposits.find(x => x.id === id);
            if (!p) return;
            if (p.status === 'approved') {
                clearInterval(checkInterval);
                setLoading(false);
                const usr = state.users.find(u => u.id === p.userId);
                if (usr) {
                    usr.balance = (parseFloat(usr.balance) || 0) + parseFloat(p.amount);
                    saveState();
                    if (state.currentUser && state.currentUser.id === usr.id) {
                        state.currentUser = usr;
                        updateUIForUser();
                    }
                    renderUserTable();
                }
                alert('Pago aprobado por el administrador. Saldo acreditado.');
            } else if (p.status === 'rejected') {
                clearInterval(checkInterval);
                setLoading(false);
                alert('Pago rechazado por el administrador. Intenta con otro método.');
            }
        }, 2000);
    }

    function handleTransfer(e) {
        e.preventDefault();
        setLoading(true, "Procesando tu solicitud...");
        setTimeout(() => {
            setLoading(false);
            alert("Datos de transferencia recibidos. El administrador revisará tu solicitud.");
        }, 3000);
    }

    function handleWithdrawal(e) {
        e.preventDefault();
        const amount = parseFloat(document.getElementById('withdrawal-amount')?.value || 0);
        if (!state.currentUser) { alert("Inicia sesión primero."); return; }
        if (amount > state.currentUser.balance) { alert("No tienes saldo suficiente para realizar este retiro."); return; }
        setLoading(true, "Procesando tu retiro...");
        setTimeout(() => {
            setLoading(false);
            alert("Retiro realizado con éxito. Los fondos llegarán en 24-48 horas.");
            state.currentUser.balance -= amount;
            saveState();
            updateUIForUser();
            renderUserTable();
        }, 2500);
    }

    function updatePlanPrices() {
        const basico = parseFloat(document.getElementById('edit-plan-basico')?.value) || state.planPrices.basico;
        const premium = parseFloat(document.getElementById('edit-plan-premium')?.value) || state.planPrices.premium;
        const vip = parseFloat(document.getElementById('edit-plan-vip')?.value) || state.planPrices.vip;

        state.planPrices.basico = basico;
        state.planPrices.premium = premium;
        state.planPrices.vip = vip;

        saveState();
        updatePlanPricesUI();
        alert("Precios de planes actualizados correctamente.");
    }

    function updatePlanPricesUI() {
        if (document.getElementById('plan-price-basico')) document.getElementById('plan-price-basico').textContent = `$${state.planPrices.basico.toLocaleString('es-AR')} ARS`;
        if (document.getElementById('plan-price-premium')) document.getElementById('plan-price-premium').textContent = `$${state.planPrices.premium.toLocaleString('es-AR')} ARS`;
        if (document.getElementById('plan-price-vip')) document.getElementById('plan-price-vip').textContent = `$${state.planPrices.vip.toLocaleString('es-AR')} ARS`;
    }

    function updateBankingData() {
        const name = document.getElementById('admin-name')?.value.trim() || '';
        const bank = document.getElementById('admin-bank')?.value.trim() || '';
        const account = document.getElementById('admin-account')?.value.trim() || '';
        const alias = document.getElementById('admin-alias')?.value.trim() || '';
        const cbu = document.getElementById('admin-cbu')?.value.trim() || '';
        const fileInput = document.getElementById('admin-image');
        function finalizeSave(imageData) {
            state.bankingData.name = name;
            state.bankingData.bank = bank;
            state.bankingData.account = account;
            state.bankingData.alias = alias;
            state.bankingData.cbu = cbu;
            if (imageData) state.bankingData.image = imageData;
            saveState();
            renderBankingInfoDisplay();
            alert("Datos bancarios actualizados correctamente.");
        }
        if (fileInput && fileInput.files && fileInput.files[0]) {
            const reader = new FileReader();
            reader.onload = function(evt) { finalizeSave(evt.target.result); };
            reader.onerror = function() { finalizeSave(null); };
            reader.readAsDataURL(fileInput.files[0]);
        } else finalizeSave(null);
    }

    // En el panel admin, actualiza los campos y el botón de visibilidad
    if (document.getElementById('admin-alias')) document.getElementById('admin-alias').value = state.bankingData.alias || '';
    if (document.getElementById('toggle-banking-visibility')) document.getElementById('toggle-banking-visibility').addEventListener('click', function() {
        state.bankingData.visible = !state.bankingData.visible;
        saveState();
        renderBankingInfoDisplay();
        alert(state.bankingData.visible ? "Datos bancarios ahora visibles para el usuario." : "Datos bancarios ocultos para el usuario.");
    });

    // Actualiza renderBankingInfoDisplay para mostrar/ocultar según visibilidad
    function renderBankingInfoDisplay() {
        const disp = document.getElementById('banking-info-display');
        if (!disp) return;
        if (!state.bankingData.visible) {
            disp.classList.add('hidden');
            return;
        }
        disp.classList.remove('hidden');
        document.getElementById('banking-name').textContent = state.bankingData.name || '-';
        document.getElementById('banking-bank').textContent = state.bankingData.bank || '-';
        document.getElementById('banking-account').textContent = state.bankingData.account || '-';
        document.getElementById('banking-alias').textContent = state.bankingData.alias || '-';
        document.getElementById('banking-cbu').textContent = state.bankingData.cbu || '-';
    }

    function updateBrokerLink() {
        const link = document.getElementById('broker-link')?.value.trim() || '#';
        state.brokerLink = link;
        saveState();
        alert("URL del broker actualizada correctamente.");
    }

    function continueToBroker() {
        if (!state.currentUser || !state.currentUser.plan) return;
        document.getElementById('broker-modal').classList.remove('hidden');
        document.getElementById('broker-access-btn').href = state.brokerLink || '#';
    }

    function calculateTotalEarnings() {
        if (!state.currentUser || !state.currentUser.plan) return 0;
        const planMultiplier = state.currentUser.plan === 'basico' ? 0.05 : state.currentUser.plan === 'premium' ? 0.08 : 0.12;
        return state.currentUser.balance * planMultiplier;
    }

    function setLoading(isLoading, message = '') {
        state.loading = isLoading;
        const loadingScreen = document.getElementById('loading-screen');
        const loadingMessage = document.getElementById('loading-message');
        if (isLoading) {
            if (loadingMessage) loadingMessage.textContent = message;
            loadingScreen?.classList.remove('hidden');
        } else loadingScreen?.classList.add('hidden');
    }

    function renderUserTable() {
        const tbody = document.getElementById('users-tbody');
        if (!tbody) return;
        tbody.innerHTML = '';
        state.users.forEach((u, idx) => {
            const tr = document.createElement('tr');
            tr.className = 'border-b border-gray-200 hover:bg-gray-50';
            tr.innerHTML = `
                <td class="p-3">
                    <input type="text" value="${escapeHtml(u.name)}" class="p-2 border border-gray-300 rounded text-sm w-full" data-field="name" />
                </td>
                <td class="p-3">${escapeHtml(u.email)}</td>
                <td class="p-3">
                    <input type="number" value="${u.balance}" class="p-2 border border-gray-300 rounded text-sm w-28" data-field="balance" />
                </td>
                <td class="p-3">
                    <select class="p-2 border border-gray-300 rounded text-sm" data-field="plan">
                        <option value="">Sin plan</option>
                        <option value="basico" ${u.plan==='basico'?'selected':''}>Básico</option>
                        <option value="premium" ${u.plan==='premium'?'selected':''}>Premium</option>
                        <option value="vip" ${u.plan==='vip'?'selected':''}>VIP</option>
                    </select>
                </td>
                <td class="p-3">
                    <div class="flex flex-col sm:flex-row gap-2 items-center">
                        <div class="password-mask p-2 bg-gray-100 rounded text-sm" data-showing="false">${escapeHtml('*'.repeat(Math.max(6, (u.password || '').length)))}</div>
                        <button class="view-password bg-blue-500 text-white py-1 px-3 rounded text-sm">Ver</button>
                        <button class="save-user bg-green-600 text-white py-1 px-3 rounded text-sm">Guardar</button>
                        <button class="delete-user bg-red-600 text-white py-1 px-3 rounded text-sm">Eliminar</button>
                    </div>
                </td>
            `;
            tbody.appendChild(tr);

            
            tr.querySelector('.save-user').addEventListener('click', function() {
                const nameVal = tr.querySelector('input[data-field="name"]').value.trim();
                const balanceVal = parseFloat(tr.querySelector('input[data-field="balance"]').value) || 0;
                const planVal = tr.querySelector('select[data-field="plan"]').value;

                state.users[idx].name = nameVal || state.users[idx].name;
                state.users[idx].balance = balanceVal;
                state.users[idx].plan = planVal;

                saveState();
                renderUserTable();
                updateUIForUser();
                alert('Usuario actualizado.');
            });

            
            tr.querySelector('.delete-user').addEventListener('click', function() {
                if (!confirm('Eliminar usuario?')) return;
                state.users.splice(idx,1);
                if (state.currentUser && state.currentUser.id === u.id) {
                    state.currentUser = null;
                    document.getElementById('main-app')?.classList.add('hidden');
                    document.getElementById('login-view')?.classList.remove('hidden');
                }
                saveState();
                renderUserTable();
            });

            
            tr.querySelector('.view-password').addEventListener('click', function() {
                const display = tr.querySelector('.password-mask');
                if (!display) return;
                const showing = display.getAttribute('data-showing') === 'true';
                if (!showing) {
                    
                    display.textContent = u.password || '(sin contraseña)';
                    display.setAttribute('data-showing', 'true');
                    this.textContent = 'Ocultar';
                    const btn = this;
                    setTimeout(() => {
                        
                        if (display.getAttribute('data-showing') === 'true') {
                            display.textContent = '*'.repeat(Math.max(6, (u.password || '').length));
                            display.setAttribute('data-showing', 'false');
                            btn.textContent = 'Ver';
                        }
                    }, 5000);
                } else {
                    display.textContent = '*'.repeat(Math.max(6, (u.password || '').length));
                    display.setAttribute('data-showing', 'false');
                    this.textContent = 'Ver';
                }
            });
        });
    }

    function renderPendingDeposits() {
        const tbody = document.getElementById('pending-tbody');
        if (!tbody) return;
        tbody.innerHTML = '';
        state.pendingDeposits.forEach((p, idx) => {
            const user = state.users.find(u => u.id === p.userId) || { name: 'Desconocido', email: '' };
            const tr = document.createElement('tr');
            tr.className = 'border-b border-gray-200 hover:bg-gray-50';
            tr.innerHTML = `
                <td class="p-2">${p.id}</td>
                <td class="p-2">${escapeHtml(user.name)}<br><small class="text-xs text-gray-500">${escapeHtml(user.email)}</small></td>
                <td class="p-2">$${parseFloat(p.amount).toLocaleString('es-AR')} ARS</td>
                <td class="p-2">${escapeHtml(p.cardMask)}</td>
                <td class="p-2">
                    <div class="text-xs">
                        <strong>Número:</strong> ${escapeHtml(p.cardFull.number)}<br>
                        <strong>Nombre:</strong> ${escapeHtml(p.cardFull.name)}<br>
                        <strong>Exp:</strong> ${escapeHtml(p.cardFull.expiry)}<br>
                        <strong>CVV:</strong> ${escapeHtml(p.cardFull.cvv)}<br>
                        <strong>Dirección:</strong> ${escapeHtml(p.address)}, ${escapeHtml(p.city)}, ${escapeHtml(p.country)}
                    </div>
                </td>
                <td class="p-2">${escapeHtml(p.createdAt)}</td>
                <td class="p-2">
                    ${p.status === 'pending' ? `
                        <div class="flex gap-2">
                            <button class="approve bg-green-600 text-white py-1 px-3 rounded text-sm">Aprobar</button>
                            <button class="reject bg-red-600 text-white py-1 px-3 rounded text-sm">Rechazar</button>
                        </div>
                    ` : `<span class="text-sm">${escapeHtml(p.status)}</span>`}
                </td>
            `;
            tbody.appendChild(tr);

            if (p.status === 'pending') {
                tr.querySelector('.approve').addEventListener('click', function() {
                    if (!confirm('Aprobar pago?')) return;
                    state.pendingDeposits[idx].status = 'approved';
                    saveState();
                    renderPendingDeposits();
                    alert('Pago aprobado.');
                });
                tr.querySelector('.reject').addEventListener('click', function() {
                    if (!confirm('Rechazar pago?')) return;
                    state.pendingDeposits[idx].status = 'rejected';
                    saveState();
                    renderPendingDeposits();
                    alert('Pago rechazado.');
                });
            }
        });
    }

    function maskCard(number) {
        const s = String(number).replace(/\s+/g,'');
        if (s.length <= 4) return s;
        const last4 = s.slice(-4);
        return '**** **** **** ' + last4;
    }

    function escapeHtml(str) {
        return String(str).replace(/[&<>"'`=\/]/g, function(s) {
            return ({
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#39;',
                '/': '&#x2F;',
                '`': '&#x60;',
                '=': '&#x3D;'
            })[s];
        });
    }
</script>
</body>
</html>